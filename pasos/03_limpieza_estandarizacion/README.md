# ——— Reescribir README bonito para el Paso 3 ———
stopifnot(dir.exists("pasos/03_limpieza_estandarizacion"))

md <- c(
  "# Paso 3 — Chequeos y saneamiento ligero",
  "",
  "Validaciones rápidas sobre la tabla generada en el **Paso 2** antes de integrar o modelar.",
  "",
  "## Objetivo",
  "- Verificar columnas mínimas, tipos y llaves.",
  "- Generar resúmenes (distrito–año, totales, NA) y alertar duplicados.",
  "",
  "## Script",
  "- `pasos/03_limpieza_estandarizacion/paso3_chequeos_saneamiento.R`",
  "",
  "## Entradas",
  "- `data_clean/data_clean.csv` (creado en el Paso 2).",
  "",
  "## Salidas",
  "- `resumen_distrito_anio.csv`  (distrito, anio, empresas_stock, denuncias, llamadas, camaras)",
  "- `resumen_totales.csv`        (totales globales)",
  "- `resumen_na.csv`             (NAs por columna)",
  "- `duplicados_llave.csv`       (solo si se detectan `ubigeo–distrito–anio` duplicados)",
  "",
  "## Qué hace el script",
  "1. Lee `data_clean/data_clean.csv` (o `./data_clean.csv` como fallback).",
  "2. Normaliza nombres clave (`ubigeo, departamento, provincia, distrito, anio, n_empresas, n_denuncias, n_llamadas, n_camaras`).",
  "3. Enforcea tipos (`anio` y métricas a `integer`; `ubigeo` en `character`).",
  "4. Imprime vistas rápidas (head y glimpse) y lista años y distritos.",
  "5. Crea resumen **distrito–año** y **totales**.",
  "6. Cuenta **NA** por columna.",
  "7. Detecta **llaves duplicadas** y guarda el detalle si existe.",
  "",
  "## Requisitos",
  "- R ≥ 4.x",
  "- Paquetes: `dplyr`, `janitor`, `readr`, `rlang`, `tidyr`",
  "",
  "## Ejecución",
  "```r",
  "# Parado en la raíz del repo",
  "source(\"pasos/03_limpieza_estandarizacion/paso3_chequeos_saneamiento.R\")",
  "```",
  "",
  "## Estructura",
  "```\n03_limpieza_estandarizacion/\n├─ README.md\n└─ paso3_chequeos_saneamiento.R\n```",
  "",
  "> Nota: si falta alguna columna crítica, el script se detiene y te pide regenerar el Paso 2."
)

writeLines(md, "pasos/03_limpieza_estandarizacion/README.md")
cat("✅ README del Paso 3 actualizado con formato limpio.\n")
